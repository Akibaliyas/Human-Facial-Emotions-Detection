<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Facial Emotion Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
</head>

<style>
/* ---------------- LIGHT MODE ---------------- */
body {
    background: {{ theme_color if theme_color else "linear-gradient(135deg, #74ebd5, #acb6e5)" }};
    padding: 20px;
    transition: background 0.4s ease, color 0.4s ease;
}

.app-title {
    font-size: 2.5rem;
    color: white;
    background-color: #4a90e2;
    padding: 15px;
    border-radius: 12px;
}

/* Dark toggle */
.dark-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
}

.upload-form, .result-box, .quote-box, .webcam-container {
    background: white;
    padding: 20px;
    border-radius: 12px;
}

.img-fluid {
    border: 5px solid #4a90e2;
    border-radius: 12px;
}

.highlight {
    color: #e94e77;
    font-weight: bold;
}

.confidence-score {
    background: #dff9fb;
    padding: 8px 12px;
    border-radius: 8px;
}

.webcam-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

video {
    border-radius: 10px;
    border: 3px solid #4a90e2;
    max-width: 100%;
}

.quote-box {
    margin-top: 20px;
    animation: fadeSlide 1.2s ease-in-out;
}

@keyframes fadeSlide {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

.quote-text {
    font-style: italic;
    color: #34495e;
}

.tip-text {
    color: #2ecc71;
    font-weight: 500;
}

/* ---------------- DARK MODE ---------------- */
body.dark-mode {
    background: linear-gradient(135deg, #121212, #1f1f1f) !important;
    color: #f1f1f1;
}

body.dark-mode .upload-form,
body.dark-mode .result-box,
body.dark-mode .quote-box,
body.dark-mode .webcam-container {
    background: #1e1e1e;
}

body.dark-mode .app-title {
    background-color: #222;
}
</style>

<body>

<button id="darkToggle" class="btn btn-dark dark-toggle">üåô Dark Mode</button>

<div class="container text-center my-5 position-relative">

    <h1 class="app-title mb-4">Facial Emotion Detection App üòÉ</h1>

    <!-- Upload -->
    <form method="POST" enctype="multipart/form-data" class="upload-form mb-4">
        <input type="file" name="file" class="form-control mb-3">
        <button type="submit" class="btn btn-primary w-100">
            Upload & Detect Emotion
        </button>
    </form>

    <!-- Webcam -->
    <div class="webcam-container mb-4">
        <video id="video" width="320" height="240" autoplay muted playsinline style="display:none;"></video>

        <div class="mt-3">
            <button id="toggleCamera" class="btn btn-dark">Start Camera</button>
            <button id="captureBtn" class="btn btn-success" disabled>Capture & Detect</button>
        </div>

        <form method="POST" id="webcamForm">
            <input type="hidden" name="webcam_image" id="webcam_image">
        </form>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if image_path %}
        <img src="{{ url_for('static', filename=image_path) }}"
             class="img-fluid mt-4" width="260">
    {% endif %}

    {% if emotion %}
        <div class="result-box mt-4">
            <h3>Emotion: <span class="highlight">{{ emotion }}</span></h3>
            <p class="confidence-score">Confidence: {{ confidence }}%</p>

            <a class="btn btn-outline-success mt-3"
               href="{{ url_for('static', filename=pdf_file) }}"
               download>
               üìÑ Download Session Report (PDF)
            </a>

            <h6 class="mt-4">Developed by Aqib Ali Ilyas & Zakir Hussain</h6>
        </div>

        <div class="quote-box mt-4">
            <h5>Quote</h5>
            <p class="quote-text">‚Äú{{ quote }}‚Äù</p>

            <h5 class="mt-3">Mental Health Tip</h5>
            <p class="tip-text">{{ tip }}</p>
        </div>
    {% endif %}

</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
/* ---------- Dark Mode ---------- */
const darkBtn = document.getElementById("darkToggle");

if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark-mode");
    darkBtn.innerText = "‚òÄÔ∏è Light Mode";
}

darkBtn.onclick = () => {
    document.body.classList.toggle("dark-mode");
    if (document.body.classList.contains("dark-mode")) {
        localStorage.setItem("darkMode", "enabled");
        darkBtn.innerText = "‚òÄÔ∏è Light Mode";
    } else {
        localStorage.setItem("darkMode", "disabled");
        darkBtn.innerText = "üåô Dark Mode";
    }
};

/* ---------- Webcam ---------- */
let videoStream = null;
const video = document.getElementById("video");
const captureBtn = document.getElementById("captureBtn");
const toggleBtn = document.getElementById("toggleCamera");

toggleBtn.onclick = async () => {
    if (!videoStream) {
        videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = videoStream;
        video.style.display = "block";
        toggleBtn.innerText = "Stop Camera";
        captureBtn.disabled = false;
    } else {
        videoStream.getTracks().forEach(t => t.stop());
        video.srcObject = null;
        video.style.display = "none";
        videoStream = null;
        toggleBtn.innerText = "Start Camera";
        captureBtn.disabled = true;
    }
};

captureBtn.onclick = () => {
    const canvas = document.getElementById("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    document.getElementById("webcam_image").value = canvas.toDataURL("image/jpeg");
    document.getElementById("webcamForm").submit();
};
</script>

</body>
</html> 